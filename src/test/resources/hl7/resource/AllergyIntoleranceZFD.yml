#
# (c) Te Whatu Ora, Health New Zealand, 2023
#
# SPDX-License-Identifier: Apache-2.0
#
## pretend AllergyIntolerance from ZFD custom segment
##   - actually for testing use of custom segment fields in conditions.
---
resourceType: AllergyIntolerance

type_1:
  condition: $zfd3 EQUALS H1 || $zfd3 EQUALS H2
  generateList: false
  expressionType: HL7Spec
  valueOf: $code
  vars:
     zfd3: ZFD.3
  constants:
     code: allergy

type_2:
  condition: $zfd3 NOT_EQUALS H1 && $zfd3 NOT_EQUALS H2
  generateList: false
  expressionType: HL7Spec
  valueOf: $code
  vars:
     zfd3: ZFD.3
  constants:
     code: intolerance

clinicalStatus:
  valueOf: datatype/CodeableConcept_var
  generateList: true
  expressionType: resource
  constants:
    system: "http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical"
    code: "activeXXX"
    display: "Active"

verificationStatus:
  valueOf: datatype/CodeableConcept_var
  generateList: true
  expressionType: resource
  constants:
    system: "http://terminology.hl7.org/CodeSystem/allergyintolerance-verification"
    code: "confirmed"
    display: "Confirmed"

# field ZFD-4 is absent --> LOW
criticality_1:
  condition: $zfd4 NULL
  valueOf: $code
  expressionType: HL7Spec
  constants:
    code: low
  vars:
    zfd4: ZFD.4

# field ZFD-4 is present --> HIGH
criticality_2:
  condition: $zfd4 NOT_NULL
  valueOf: $code
  expressionType: HL7Spec
  constants:
    code: high
  vars:
    zfd4: ZFD.4